---
title: "Top_GO_analysis"
output: pdf_document
editor_options: 
  chunk_output_type: console
---
#################################
# Plot gene ontology enrichment #
#################################
```{r}
# Requires the package 'ggplot2' (needs to be installed first)get
# Load the ggplot2 package
library(ggplot2)
```
# set the working directory where the tables to use are located
```{r}
#setwd("C:/Users/daliagala/Documents/Glia_review/Figures/TopGO_analysis")
```
# Prepare dataframe
#------------------
# Import the table containing the enriched GO terms
```{r}
all_protrusion_onto <- read.csv("./output_cutoffs/all_protrusion_onto.csv",header=T,stringsAsFactors = T)
all_enriched_onto <- read.csv("./output_cutoffs/all_enriched_onto.csv",header=T,stringsAsFactors = T)
all_translated_onto <- read.csv("./output_cutoffs/all_translated_onto.csv",header=T,stringsAsFactors = T)
protrusion_enriched_onto <- read.csv("./output_cutoffs/protrusion_enriched_onto.csv",header=T,stringsAsFactors = T)
protrusion_translated_onto <- read.csv("./output_cutoffs/protrusion_translated_onto.csv",header=T,stringsAsFactors = T)
protrusion_enriched_translated_onto <- read.csv("./output_cutoffs/protrusion_enriched_translated_onto.csv",header=T,stringsAsFactors = T)
```
#Compare all the same GO
```{r}
common <- merge(GO_all, GO_all_out, by = "Term")
```
# List objects and their structure contained in the dataframe 'GO_all'
```{r}
ls.str(GO_all)
```
# Transform the column 'Significant' into a numeric variable
```{r}
all_protrusion_onto$Significant <- as.numeric(all_protrusion_onto$Significant)
```
# Replace all the "_" by a space in the column containing the GO terms
```{r}
all_protrusion_onto$Term <- chartr("_", " ", all_protrusion_onto$Term)
```
# Transform FDR values by -log10('FDR values')
```{r}
#GO_all$'|log10(FDR)|' <- -(log10(GO_all$FDR))
```
# Draw the plot with ggplot2
```{r}
#GO_all %>% pull(Term) %>% unique() %>% length()
#GO_all %>% pull(Term) %>% length()


ggplot(all_protrusion_onto, aes(x = Term, y = foldEnrichment)) +
  geom_hline(yintercept = 3.5, linetype="dashed", 
             color = "azure4", size=.5)+
  geom_point(data=all_protrusion_onto,aes(x=Term, y=foldEnrichment,size = Significant, colour = `bonferroni`), alpha=.7)+
  scale_x_discrete(limits= all_protrusion_onto$Term)+
  scale_color_gradient(low="dark green",high="dark red",limits=c(0, NA))+
  coord_flip()+
  theme_bw()+
  theme(axis.ticks.length=unit(-0.1, "cm"),
        axis.text.x = element_text(margin=margin(5,5,0,5,"pt")),
        axis.text.y = element_text(margin=margin(5,5,5,5,"pt")),
        axis.text = element_text(color = "black"),
        panel.grid.minor = element_blank(),
        legend.title.align=0.5)+
  xlab("")+
  ylab("Fold enrichment")+
  labs(color="Bonferroni", size="Number\nof genes")+ #Replace by your variable names; \n allow a new line for text
  guides(y = guide_axis(order=2),
         colour = guide_colourbar(order=1))
```
#Save
```{r}
library(venn)
listInput <- list(Protrusion_Enriched = names(protrusion_enriched_onto),
                  Protrusion_Translated = names(protrusion_translated_onto))
venn(listInput, ilab=TRUE, zcolor = "style")
```

