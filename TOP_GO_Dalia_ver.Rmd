---
title: "Top_GO_Dalia_version"
output: pdf_document
editor_options: 
  chunk_output_type: console
---
# Environment
```{r}
library(tidyverse)
library(janitor)
library(biomaRt)
```
### Download genomes and annotations
* ENSEMBL mouse 96
```{r}
mouse_mart96 <- useMart("ENSEMBL_MART_ENSEMBL", dataset = "mmusculus_gene_ensembl", 
                   host = "https://apr2019.archive.ensembl.org")
#listAttributes(mouse_mart96)
#listFilters(mouse_mart96)
mouse_ens <- getBM(attributes = c("ensembl_gene_id", "external_gene_name", "gene_biotype"),
      mart = mouse_mart96)
```
# Load the summary table
```{r}
summary_table <- read_csv("./Glial-summary-table.csv")
all_protrusion <- filter(summary_table, RNA_in_protrusion == "12")
all_enriched <- filter(summary_table, enriched_in_protrusion == "4"|enriched_in_protrusion == "3")
all_translated <- filter(summary_table, translation_in_protrusion == "4")
protrusion_enriched <- filter(summary_table, RNA_in_protrusion == "12" & enriched_in_protrusion == "4"|enriched_in_protrusion == "3")
protrusion_translated <- filter(summary_table, RNA_in_protrusion == "12" & translation_in_protrusion == "4")
protrusion_enriched_translated <- filter(summary_table, RNA_in_protrusion == "12" & translation_in_protrusion == "4" & enriched_in_protrusion == "3"|enriched_in_protrusion == "4")
```
# Perform TopGO
```{r}
## Custom function
source("./src/runTopGO.R")

runTopGO_dalia <- function(ontology, target_list){
  runTopGO(ontology = ontology,
           species = "human",
           backgroundGenes = full_human_genes,
           targetedGenes = target_list) %>%
    mutate(Ontology = ontology)
}
```
## Define ontologies
```{r}
ontologies <- c("BP", "MF", "CC")
```
## Perform TopGO
```{r}
GO_with_neuro    <- map2_dfr(ontologies, list(with_neuro), runTopGO_dalia)
GO_without_neuro <- map2_dfr(ontologies, list(without_neuro), runTopGO_dalia)
```
## Export
```{r}
write_csv(GO_with_neuro, "./output/DSG/GO_with_neuro_20211110.csv")
write_csv(GO_without_neuro, "./output/DSG/GO_without_neuro_20211110.csv")
```